<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>GDS ì»¤ë®¤ë‹ˆí‹° & ëŒ“ê¸€ ì‹œì—°</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f0f2f5; --accent: #3b82f6; --text: #1c1e21; --border: #dddfe2; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 600px; }
        
        /* ì‘ì„± ì¹´ë“œ */
        .card { background: white; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); padding: 16px; margin-bottom: 20px; }
        textarea { width: 100%; border: 1px solid var(--border); border-radius: 6px; padding: 10px; resize: none; box-sizing: border-box; font-family: inherit; margin-bottom: 10px; }
        .btn { background: var(--accent); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; float: right; }
        
        /* ê²Œì‹œê¸€ ì¹´ë“œ */
        .post { background: white; border-radius: 8px; padding: 16px; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .post-user { font-weight: 600; color: var(--accent); margin-bottom: 8px; }
        .post-content { margin-bottom: 15px; line-height: 1.4; }
        
        /* ëŒ“ê¸€ ì„¹ì…˜ */
        .comment-section { border-top: 1px solid var(--border); padding-top: 10px; background: #fafafa; margin: 0 -16px -16px -16px; padding: 16px; border-radius: 0 0 8px 8px; }
        .comment { font-size: 14px; margin-bottom: 8px; display: flex; gap: 8px; }
        .comment-user { font-weight: 600; font-size: 13px; }
        .comment-input-wrap { display: flex; gap: 8px; margin-top: 10px; }
        .comment-input { flex: 1; font-size: 13px; padding: 6px; border: 1px solid var(--border); border-radius: 4px; }
        .comment-btn { font-size: 12px; padding: 4px 8px; }
        .clearfix::after { content: ""; clear: both; display: table; }
    </style>
</head>
<body>

<div class="container">
    <h2>GDS ì»¤ë®¤ë‹ˆí‹° ì‹œì—°</h2>

    <div class="card clearfix">
        <textarea id="postInput" placeholder="ìƒˆë¡œìš´ ì†Œì‹ì„ ê³µìœ í•˜ì„¸ìš”..."></textarea>
        <button class="btn" onclick="sendData(null)">ê²Œì‹œë¬¼ ì˜¬ë¦¬ê¸°</button>
    </div>

    <div id="feed"></div>
</div>

<script>
    async function sendData(postId) {
        const inputId = postId ? `reply-${postId}` : 'postInput';
        const input = document.getElementById(inputId);
        const text = input.value.trim();

        if (!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!");

        try {
            const response = await fetch('/comments', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    content: text,
                    user: "User_" + Math.floor(Math.random()*100),
                    post_id: postId
                })
            });

            const result = await response.json();
            
            if (postId) {
                // ëŒ“ê¸€ UI ì—…ë°ì´íŠ¸
                renderComment(postId, "ë‚˜", text);
            } else {
                // ìƒˆ ê²Œì‹œë¬¼ UI ì—…ë°ì´íŠ¸
                renderPost(result.post);
            }
            input.value = '';
        } catch (e) { alert("ì „ì†¡ ì‹¤íŒ¨!"); }
    }

    function renderPost(post) {
        const feed = document.getElementById('feed');
        const html = `
            <div class="post" id="p-${post.id}">
                <div class="post-user">ğŸ‘¤ ${post.user}</div>
                <div class="post-content">${post.content}</div>
                <div class="comment-section">
                    <div id="list-${post.id}"></div>
                    <div class="comment-input-wrap">
                        <input type="text" class="comment-input" id="reply-${post.id}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”...">
                        <button class="btn comment-btn" onclick="sendData('${post.id}')">ë“±ë¡</button>
                    </div>
                </div>
            </div>
        `;
        feed.insertAdjacentHTML('afterbegin', html);
    }

    function renderComment(postId, user, content) {
        const list = document.getElementById(`list-${postId}`);
        const html = `
            <div class="comment">
                <span class="comment-user">${user}:</span>
                <span>${content}</span>
            </div>
        `;
        list.insertAdjacentHTML('beforeend', html);
    }
</script>

</body>
</html>